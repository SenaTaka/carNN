# 使用例 - Usage Example

## Web UIトラックエディタを使った完全なワークフロー

このガイドでは、トラックエディタを使ってカスタムコースを作成し、シミュレーションで実行するまでの完全な手順を説明します。

### ステップ1: トラックエディタを開く

1. ブラウザで `track_editor.html` を開きます

```bash
# macOS
open track_editor.html

# Linux
xdg-open track_editor.html

# Windows
start track_editor.html
```

または、ブラウザにファイルをドラッグ&ドロップします。

### ステップ2: コースをデザインする

#### 基本操作

1. **ウェイポイントを追加する**
   - キャンバス上の任意の場所をクリック
   - 順番にクリックしてコースの形を作る
   - 最低でも3つのウェイポイントが必要

2. **ウェイポイントを移動する**
   - 「🖱️ 移動モードに切替」ボタンをクリック
   - ウェイポイントをドラッグして位置を調整
   - 「➕ 追加モードに切替」で元に戻る

3. **ウェイポイントを削除する**
   - 削除したいウェイポイントを右クリック

4. **ズームと表示調整**
   - マウスホイールで拡大/縮小
   - コース幅やスケールをサイドバーで調整

#### 初めての方へのヒント

最初は既にロードされているデフォルトトラックを少し変更してみることをお勧めします：

1. いくつかのウェイポイントを移動してみる
2. コース幅を変更してみる（例: 7.5m → 10m）
3. 結果をプレビューで確認

### ステップ3: トラックをエクスポートする

コースのデザインが完成したら、2つの方法でエクスポートできます：

#### 方法A: JSONファイルとして保存（推奨）

1. 「📥 JSONでダウンロード」ボタンをクリック
2. `track.json` ファイルがダウンロードされる
3. ファイルを `carNN` ディレクトリに配置

#### 方法B: Pythonコードをコピー

1. 「🐍 Pythonコードをコピー」ボタンをクリック
2. クリップボードにコードがコピーされる
3. `g_save.py` を開いて直接貼り付ける

### ステップ4: シミュレーションで使用する

#### JSONファイルを使う場合

`g_save.py` を開いて、以下の行を編集：

```python
# トラック設定
TRACK_JSON = "track.json"  # あなたのJSONファイルのパス
```

#### Pythonコードを使う場合

`g_save.py` の `generate_complex_track()` 関数を編集：

```python
def generate_complex_track(track_json_path=None):
    """
    Generate track from JSON file or use default waypoints.
    """
    # この行の下にコピーしたコードを貼り付け
    base_waypoints = np.array([
        [0, -20], [-30, -20], [-20, 20],  # あなたのウェイポイント
        # ...
    ])
    scale = 2.0  # あなたのスケール
    width = 7.5  # あなたのコース幅
    
    # 以下はそのまま
    waypoints = base_waypoints * scale
    # ...
```

### ステップ5: シミュレーションを実行する

```bash
python3 g_save.py
```

実行すると以下が表示されます：

```
🚧 Generating Real-Scale Track...
📂 Loading custom track from: track.json
✅ Loaded 14 waypoints (scale=2.0, width=7.5m)
```

成功！あなたのカスタムトラックでAIが走行します。

## 実践例

### 例1: シンプルな楕円コース

最も基本的なコースから始めましょう。

1. エディタで「🗑️ すべて削除」をクリック
2. 以下の位置にウェイポイントを配置：
   - (0, 0) - 左上
   - (50, 0) - 右上
   - (70, 30) - 右下
   - (0, 30) - 左下
3. コース幅: 10m
4. スケール: 2.0
5. エクスポート → `simple_oval.json`

このコースは初心者のAI学習に最適です。

### 例2: テクニカルコース

より複雑なコースを作りたい場合：

1. デフォルトのトラックを基準にする
2. いくつかのヘアピンカーブを追加
3. 長い直線区間を作る
4. S字カーブを入れる

ヒント：
- 急カーブにはウェイポイントを密に配置
- 緩やかなカーブにはウェイポイントを疎に配置
- 直線部分は2つのウェイポイントだけで十分

### 例3: 既存トラックの編集

既存のトラックを改良したい場合：

1. 「📂 ファイルを開く」をクリック
2. `sample_track.json` を選択
3. 気になる部分を調整
4. 新しい名前でエクスポート（例: `track_v2.json`）

## トラブルシューティング

### Q: AIがコースを完走できない

**A**: 以下を試してください：

1. **コースを簡単にする**
   - ヘアピンカーブを減らす
   - カーブを緩やかにする
   - ウェイポイントを調整

2. **コース幅を広くする**
   - 7.5m → 10m に変更
   - AIに十分なマージンを与える

3. **シミュレーション時間を延長**
   - `g_save.py` で `SIM_STEPS = 50000` に増やす

### Q: エクスポートしたトラックが読み込めない

**A**: 以下を確認：

1. JSONファイルが `g_save.py` と同じディレクトリにあるか
2. `TRACK_JSON` のパスが正しいか
3. track_loader.py を使って検証：
   ```bash
   python3 track_loader.py your_track.json
   ```

### Q: トラックが歪んで表示される

**A**: 以下を調整：

1. **スプライン解像度を上げる**
   - 50 → 100 に変更
   - より滑らかなカーブになる

2. **スケールを調整**
   - 大きすぎる/小さすぎる場合は適切な値に

3. **ウェイポイントの配置を見直す**
   - 極端に近い/遠いウェイポイントを調整

## ベストプラクティス

### コースデザインのコツ

1. **段階的に複雑にする**
   - 最初はシンプルなコースで始める
   - AIが完走できたら少しずつ難しくする

2. **バランスを取る**
   - カーブと直線のバランス
   - 簡単な区間と難しい区間のミックス

3. **テストと改善**
   - エクスポート → シミュレーション → 調整
   - このサイクルを繰り返す

4. **バージョン管理**
   - 異なるバージョンを保存（track_v1.json, track_v2.json）
   - 改悪した場合に戻れるように

### 保存のヒント

- **わかりやすいファイル名**
  - `track_simple.json` - シンプルなコース
  - `track_technical.json` - テクニカルコース
  - `track_long.json` - ロングコース

- **コメントを付ける**
  - JSONファイルと一緒にREADMEを作成
  - どんなコースか説明を書く

## 次のステップ

トラックエディタに慣れたら：

1. 実在のサーキットを模倣してみる
2. オリジナルの挑戦的なコースを作る
3. 複数のコースでAIをテストして最強のモデルを作る
4. コミュニティとトラックを共有する

楽しいレーシング体験を！🏎️💨

---

**最終更新**: 2025-12-05
